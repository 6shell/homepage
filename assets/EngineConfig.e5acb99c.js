var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(a,t,n)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,i=(e,i)=>{for(var o in i||(i={}))t.call(i,o)&&l(e,o,i[o]);if(a)for(var o of a(i))n.call(i,o)&&l(e,o,i[o]);return e};import{D as o}from"./vuedraggable.umd.73acac10.js";import{g as s}from"./images.070572cf.js";import{_ as c,d as r,r as d,y as m,a as p,H as u,b as g,l as f,i as h,j as y,e as v,k as b,m as k,F as D,a0 as w,Q as T,v as E,a3 as _,s as x,t as P,h as L,o as V,I,p as O,c as U,U as C}from"./index.d3eb4bc8.js";const j=[{label:"API获取",value:"api"},{label:"文字图标",value:"text"},{label:"网络图片",value:"network"}],A=r({name:"EngineConfig",components:{Draggable:o},props:{engineList:{type:Array,required:!0},backupEngineList:{type:Array,required:!0}},emits:["update"],setup(e,{emit:a}){const t=d(!1),n=d(!1),l=d([]),o=d([]),c=d(""),r=d();m((()=>{l.value=JSON.parse(JSON.stringify(e.engineList)),o.value=JSON.parse(JSON.stringify(e.backupEngineList))}));const f=p({formData:{_id:"",name:"",link:"",iconType:"api",iconPath:""},formRules:{name:[{required:!0,message:"请输入引擎名称",trigger:"blur"}],link:[{required:!0,message:"请输入引擎地址",trigger:"blur"}],iconType:[{required:!0,message:"请选择图标类型",trigger:"change"}],iconPath:[{validator:function(e,a,t){"network"!==f.formData.iconType||a?t():t(new Error("请输入图标地址"))},trigger:"blur"}]}});const h=d(),y=u((()=>"api"===f.formData.iconType&&f.formData.link||"network"===f.formData.iconType&&f.formData.iconPath||"text"===f.formData.iconType&&f.formData.name)),v=()=>{h.value.resetFields(),f.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},r.value.close()},b=g(!0);return{engineDialog:r,dragDisabled:t,showDeleteArea:n,cloneEngineList:l,cloneBackupEngineList:o,handleDragChoose:e=>{const{oldIndex:a}=e,{iconType:t}=l.value[a];"local"!==t&&(n.value=!0)},handleDragUnchoose:async()=>{await w(),n.value=!1},handleDragEnd:e=>{const{originalEvent:t}=e;let n;if("touchend"===t.type){const{clientX:e,clientY:a}=t.changedTouches[0];n=document.elementFromPoint(e,a)}else{const{clientX:e,clientY:a}=t;n=document.elementFromPoint(e,a)}if("delete-area"===(null==n?void 0:n.className)&&window.confirm("是否删除该自定义引擎")){const{newIndex:a}=e;l.value.splice(a,1)}a("update",{engineList:l.value,backupEngineList:o.value})},handleAddNewEngine:()=>{f.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},r.value.open()},handleEditEngine:e=>{const{_id:a,name:t,link:n,iconType:l,iconPath:i}=e;"local"!==l&&(f.formData={_id:a,name:t,link:n,iconType:l,iconPath:i},r.value.open())},iconTypeList:j,state:f,form:h,showIconPreview:y,close:v,submit:()=>{h.value.validate((async e=>{if(!e)return!1;if("api"===f.formData.iconType&&c.value)try{const e=await fetch(`${T}/api/icon?url=${encodeURIComponent(f.formData.link)}&type=link`),a=await e.text();a&&(f.formData.iconType="network",f.formData.iconPath=a)}catch{}if(f.formData._id){const e=l.value.findIndex((e=>e._id===f.formData._id));~e&&(l.value[e]=i({},E(f.formData)))}else f.formData._id=_(),l.value.push(i({},E(f.formData)));a("update",{engineList:l.value,backupEngineList:o.value}),v()}))},getTargetIcon:s,tempIconLink:c,handleLinkInputBlur:()=>{c.value=s(f.formData.link)},dialogOptions:b}}}),B=e=>(x("data-v-872924b0"),e=e(),P(),e),N={class:"engine-config",style:{"margin-left":"-100px","padding-bottom":"10px","border-bottom":"1px solid #ccc"}},q=B((()=>h("div",{class:"warning"},"拖拽下方图标可更换引擎顺序，也可添加自定义引擎，对于自定义引擎双击图标重新编辑",-1))),S={class:"content"},F=B((()=>h("div",{class:"text s-title"},"当前引擎组",-1))),J={class:"current-engine-wrapper"},R=["onDblclick","title"],X=["src"],Y=["src"],$={key:2,class:"no-icon"},z={class:"text"},H=B((()=>h("div",{class:"text s-title"},"备用引擎组",-1))),M={class:"backup-engine-wrapper"},Q={class:"engine-list-item"},W=["src"],G=["src"],K={key:2,class:"no-icon"},Z={class:"text"},ee={key:0,class:"delete-area"},ae={class:"form-control"},te=B((()=>h("i",{class:"tips el-icon-warning-outline"},null,-1))),ne=B((()=>h("div",{class:"tips"},[C("默认搜索内容会被拼接到引擎地址末尾, 也可以使用 "),h("b",null,"[0]"),C(" 对原地址搜索关键词进行占位")],-1))),le=B((()=>h("div",{class:"tips"},[C("例如: "),h("b",null,"https://juejin.im/search?query=[0]&type=all")],-1))),ie={class:"icon-img-preview-box"},oe=["src"],se=["src"],ce={key:2,class:"no-icon"},re={key:1,class:"icon-img-preview"},de={class:"footer",style:{"text-align":"right",padding:"12px"}};var me=c(A,[["render",function(e,a,t,n,l,i){const o=L("Draggable"),s=L("el-input"),c=L("el-form-item"),r=L("el-tooltip"),d=L("el-radio"),m=L("el-radio-group"),p=L("el-form"),u=L("animation-dialog");return V(),f(D,null,[h("div",N,[q,h("div",S,[h("button",{type:"button",class:"btn btn-primary btn-small btn-add",onClick:a[0]||(a[0]=(...a)=>e.handleAddNewEngine&&e.handleAddNewEngine(...a))},"添加"),F,h("div",J,[y(o,{modelValue:e.cloneEngineList,"onUpdate:modelValue":a[1]||(a[1]=a=>e.cloneEngineList=a),class:"now-engine-list engine-list","item-key":"name",group:"people",onChoose:e.handleDragChoose,onUnchoose:e.handleDragUnchoose,onEnd:e.handleDragEnd},{item:v((({element:a})=>[h("div",{class:"engine-list-item",onDblclick:t=>e.handleEditEngine(a),title:"local"!==a.iconType?"双击重新编辑":""},["local"===a.iconType||"network"===a.iconType?(V(),f("img",{key:0,src:a.iconPath,alt:"icon",width:"24",height:"24"},null,8,X)):b("",!0),"api"===a.iconType?(V(),f("img",{key:1,src:e.getTargetIcon(a.link),alt:"icon",width:"24",height:"24"},null,8,Y)):b("",!0),"text"===a.iconType?(V(),f("div",$,I(a.name.slice(0,1)),1)):b("",!0),h("div",z,I(a.name),1)],40,R)])),_:1},8,["modelValue","onChoose","onUnchoose","onEnd"])]),H,h("div",M,[y(o,{modelValue:e.cloneBackupEngineList,"onUpdate:modelValue":a[2]||(a[2]=a=>e.cloneBackupEngineList=a),"item-key":"name",group:"people",class:"backupEngineList engine-list",onEnd:e.handleDragEnd},{item:v((({element:a})=>[h("div",Q,["local"===a.iconType||"network"===a.iconType?(V(),f("img",{key:0,src:a.iconPath,alt:"icon",width:"24",height:"24"},null,8,W)):b("",!0),"api"===a.iconType?(V(),f("img",{key:1,src:e.getTargetIcon(a.link),alt:"icon",width:"24",height:"24"},null,8,G)):b("",!0),"text"===a.iconType?(V(),f("div",K,I(a.name.slice(0,1)),1)):b("",!0),h("div",Z,I(a.name),1)])])),_:1},8,["modelValue","onEnd"]),e.showDeleteArea?(V(),f("div",ee,"拖拽至此处删除")):b("",!0)])])]),y(u,k({ref:"engineDialog",animationMode:"",title:(e.state.formData._id?"编辑":"添加")+"自定义引擎",width:"min(380px, 90vw)",height:"min(460px, 80vh)",customClass:"add-engine-dialog",closeOnClickOutside:!1,listenWindowSizeChange:"",appendToBody:""},e.dialogOptions),{footer:v((()=>[h("div",de,[h("button",{type:"button",class:"btn",onClick:a[8]||(a[8]=(...a)=>e.close&&e.close(...a))},"取消"),h("button",{type:"button",class:"btn btn-primary",onClick:a[9]||(a[9]=(...a)=>e.submit&&e.submit(...a))},"确认")])])),default:v((()=>[y(p,{ref:"form","label-width":"80px",model:e.state.formData,rules:e.state.formRules},{default:v((()=>[y(c,{label:"引擎名称",prop:"name"},{default:v((()=>[y(s,{modelValue:e.state.formData.name,"onUpdate:modelValue":a[3]||(a[3]=a=>e.state.formData.name=a),placeholder:"请输入引擎名称"},null,8,["modelValue"])])),_:1}),y(c,{label:"引擎地址",prop:"link"},{default:v((()=>[h("div",ae,[y(s,{modelValue:e.state.formData.link,"onUpdate:modelValue":a[4]||(a[4]=a=>e.state.formData.link=a),placeholder:"请输入引擎地址",onBlur:e.handleLinkInputBlur},null,8,["modelValue","onBlur"]),y(r,{effect:"dark",placement:"bottom"},{content:v((()=>[ne,le])),default:v((()=>[te])),_:1})])])),_:1}),y(c,{label:"引擎图标",prop:"iconType"},{default:v((()=>[y(m,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":a[5]||(a[5]=a=>e.state.formData.iconType=a)},{default:v((()=>[(V(!0),f(D,null,O(e.iconTypeList,(e=>(V(),U(d,{label:e.value,key:e.value},{default:v((()=>[C(I(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),"network"===e.state.formData.iconType?(V(),U(c,{key:0,label:"图标地址",prop:"iconPath"},{default:v((()=>[y(m,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":a[7]||(a[7]=a=>e.state.formData.iconType=a)},{default:v((()=>[y(s,{modelValue:e.state.formData.iconPath,"onUpdate:modelValue":a[6]||(a[6]=a=>e.state.formData.iconPath=a),placeholder:"请输入图标地址"},null,8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})):b("",!0),y(c,{label:"图标预览"},{default:v((()=>[h("div",ie,[e.showIconPreview?(V(),f(D,{key:0},["network"===e.state.formData.iconType?(V(),f("img",{key:0,src:e.state.formData.iconPath,alt:"icon",width:"24",height:"24"},null,8,oe)):b("",!0),"api"===e.state.formData.iconType?(V(),f("img",{key:1,src:e.tempIconLink,alt:"icon",width:"24",height:"24"},null,8,se)):b("",!0),"text"===e.state.formData.iconType?(V(),f("div",ce,I(e.state.formData.name.slice(0,1)),1)):b("",!0)],64)):(V(),f("div",re))])])),_:1})])),_:1},8,["model","rules"])])),_:1},16,["title"])],64)}],["__scopeId","data-v-872924b0"]]);export{me as default};
