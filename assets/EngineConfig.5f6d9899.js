var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(a,t,n)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,o=(e,o)=>{for(var i in o||(o={}))t.call(o,i)&&l(e,i,o[i]);if(a)for(var i of a(o))n.call(o,i)&&l(e,i,o[i]);return e};import{D as i}from"./vuedraggable.umd.e1c826ed.js";import{g as s}from"./images.d28292c3.js";import{_ as r,d as c,r as d,G as m,a as p,L as u,b as g,k as f,f as h,g as y,w as v,x as b,F as k,a1 as D,V as w,t as T,z as E,A as _,o as x,v as L,l as P,c as V,s as I}from"./index.5a2c07f8.js";const C=[{label:"API获取",value:"api"},{label:"文字图标",value:"text"},{label:"网络图片",value:"network"}],O=c({name:"EngineConfig",components:{Draggable:i},props:{engineList:{type:Array,required:!0},backupEngineList:{type:Array,required:!0}},emits:["update"],setup(e,{emit:a}){const t=d(!1),n=d(!1),l=d([]),i=d([]),r=d(""),c=d();m((()=>{l.value=JSON.parse(JSON.stringify(e.engineList)),i.value=JSON.parse(JSON.stringify(e.backupEngineList))}));const g=p({formData:{_id:"",name:"",link:"",iconType:"api",iconPath:""},formRules:{name:[{required:!0,message:"请输入引擎名称",trigger:"blur"}],link:[{required:!0,message:"请输入引擎地址",trigger:"blur"}],iconType:[{required:!0,message:"请选择图标类型",trigger:"change"}],iconPath:[{validator:function(e,a,t){"network"!==g.formData.iconType||a?t():t(new Error("请输入图标地址"))},trigger:"blur"}]}});const f=d(),h=u((()=>"api"===g.formData.iconType&&g.formData.link||"network"===g.formData.iconType&&g.formData.iconPath||"text"===g.formData.iconType&&g.formData.name)),y=()=>{f.value.resetFields(),g.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},c.value.close()};return{engineDialog:c,dragDisabled:t,showDeleteArea:n,cloneEngineList:l,cloneBackupEngineList:i,handleDragChoose:e=>{const{oldIndex:a}=e,{iconType:t}=l.value[a];"local"!==t&&(n.value=!0)},handleDragUnchoose:async()=>{await D(),n.value=!1},handleDragEnd:e=>{const{originalEvent:t}=e;let n;if("touchend"===t.type){const{clientX:e,clientY:a}=t.changedTouches[0];n=document.elementFromPoint(e,a)}else{const{clientX:e,clientY:a}=t;n=document.elementFromPoint(e,a)}if("delete-area"===(null==n?void 0:n.className)&&window.confirm("是否删除该自定义引擎")){const{newIndex:a}=e;l.value.splice(a,1)}a("update",{engineList:l.value,backupEngineList:i.value})},handleAddNewEngine:()=>{g.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},c.value.open()},handleEditEngine:e=>{const{_id:a,name:t,link:n,iconType:l,iconPath:o}=e;"local"!==l&&(g.formData={_id:a,name:t,link:n,iconType:l,iconPath:o},c.value.open())},iconTypeList:C,state:g,form:f,showIconPreview:h,close:y,submit:()=>{f.value.validate((async e=>{if(!e)return!1;if("api"===g.formData.iconType&&r.value)try{const e=await fetch(`${w}/api/icon?url=${encodeURIComponent(g.formData.link)}&type=link`),a=await e.text();a&&(g.formData.iconType="network",g.formData.iconPath=a)}catch{}if(g.formData._id){const e=l.value.findIndex((e=>e._id===g.formData._id));~e&&(l.value[e]=o({},T(g.formData)))}else g.formData._id=Math.random().toString(16).slice(2),l.value.push(o({},T(g.formData)));a("update",{engineList:l.value,backupEngineList:i.value}),y()}))},getTargetIcon:s,tempIconLink:r,handleLinkInputBlur:()=>{r.value=s(g.formData.link)}}}}),U=e=>(E("data-v-615de724"),e=e(),_(),e),j={class:"engine-config",style:{"margin-left":"-100px","padding-bottom":"10px","border-bottom":"1px solid #ccc"}},A=U((()=>h("div",{class:"warning"},"拖拽下方图标可更换引擎顺序，也可添加自定义引擎，对于自定义引擎双击图标重新编辑",-1))),B={class:"content"},N=U((()=>h("div",{class:"text s-title"},"当前引擎组",-1))),S={class:"current-engine-wrapper"},q=["onDblclick","title"],F=["src"],J=["src"],R={key:2,class:"no-icon"},z={class:"text"},M=U((()=>h("div",{class:"text s-title"},"备用引擎组",-1))),X={class:"backup-engine-wrapper"},Y={class:"engine-list-item"},$=["src"],G=["src"],W={key:2,class:"no-icon"},H={class:"text"},K={key:0,class:"delete-area"},Q={class:"form-control"},Z=U((()=>h("i",{class:"tips el-icon-warning-outline"},null,-1))),ee=U((()=>h("div",{class:"tips"},[I("默认搜索内容会被拼接到引擎地址末尾, 也可以使用 "),h("b",null,"[0]"),I(" 对原地址搜索关键词进行占位")],-1))),ae=U((()=>h("div",{class:"tips"},[I("例如: "),h("b",null,"https://juejin.im/search?query=[0]&type=all")],-1))),te={class:"icon-img-preview-box"},ne=["src"],le=["src"],oe={key:2,class:"no-icon"},ie={key:1,class:"icon-img-preview"},se={class:"footer",style:{"text-align":"right",padding:"12px"}};var re=r(O,[["render",function(e,a,t,n,l,o){const i=g("Draggable"),s=g("el-input"),r=g("el-form-item"),c=g("el-tooltip"),d=g("el-radio"),m=g("el-radio-group"),p=g("el-form"),u=g("animation-dialog");return x(),f(k,null,[h("div",j,[A,h("div",B,[h("button",{type:"button",class:"btn btn-primary btn-small btn-add",onClick:a[0]||(a[0]=(...a)=>e.handleAddNewEngine&&e.handleAddNewEngine(...a))},"添加"),N,h("div",S,[y(i,{modelValue:e.cloneEngineList,"onUpdate:modelValue":a[1]||(a[1]=a=>e.cloneEngineList=a),class:"now-engine-list engine-list","item-key":"name",group:"people",onChoose:e.handleDragChoose,onUnchoose:e.handleDragUnchoose,onEnd:e.handleDragEnd},{item:v((({element:a})=>[h("div",{class:"engine-list-item",onDblclick:t=>e.handleEditEngine(a),title:"local"!==a.iconType?"双击重新编辑":""},["local"===a.iconType||"network"===a.iconType?(x(),f("img",{key:0,src:a.iconPath,alt:"icon",width:"24",height:"24"},null,8,F)):b("",!0),"api"===a.iconType?(x(),f("img",{key:1,src:e.getTargetIcon(a.link),alt:"icon",width:"24",height:"24"},null,8,J)):b("",!0),"text"===a.iconType?(x(),f("div",R,L(a.name.slice(0,1)),1)):b("",!0),h("div",z,L(a.name),1)],40,q)])),_:1},8,["modelValue","onChoose","onUnchoose","onEnd"])]),M,h("div",X,[y(i,{modelValue:e.cloneBackupEngineList,"onUpdate:modelValue":a[2]||(a[2]=a=>e.cloneBackupEngineList=a),"item-key":"name",group:"people",class:"backupEngineList engine-list",onEnd:e.handleDragEnd},{item:v((({element:a})=>[h("div",Y,["local"===a.iconType||"network"===a.iconType?(x(),f("img",{key:0,src:a.iconPath,alt:"icon",width:"24",height:"24"},null,8,$)):b("",!0),"api"===a.iconType?(x(),f("img",{key:1,src:e.getTargetIcon(a.link),alt:"icon",width:"24",height:"24"},null,8,G)):b("",!0),"text"===a.iconType?(x(),f("div",W,L(a.name.slice(0,1)),1)):b("",!0),h("div",H,L(a.name),1)])])),_:1},8,["modelValue","onEnd"]),e.showDeleteArea?(x(),f("div",K,"拖拽至此处删除")):b("",!0)])])]),y(u,{ref:"engineDialog",animationMode:"",title:(e.state.formData._id?"编辑":"添加")+"自定义引擎",width:"min(380px, 90vw)",height:"min(460px, 80vh)",customClass:"add-engine-dialog",closeOnClickOutside:!1,listenWindowSizeChange:"",appendToBody:""},{footer:v((()=>[h("div",se,[h("button",{type:"button",class:"btn",onClick:a[8]||(a[8]=(...a)=>e.close&&e.close(...a))},"取消"),h("button",{type:"button",class:"btn btn-primary",onClick:a[9]||(a[9]=(...a)=>e.submit&&e.submit(...a))},"确认")])])),default:v((()=>[y(p,{ref:"form","label-width":"80px",model:e.state.formData,rules:e.state.formRules},{default:v((()=>[y(r,{label:"引擎名称",prop:"name"},{default:v((()=>[y(s,{modelValue:e.state.formData.name,"onUpdate:modelValue":a[3]||(a[3]=a=>e.state.formData.name=a),placeholder:"请输入引擎名称"},null,8,["modelValue"])])),_:1}),y(r,{label:"引擎地址",prop:"link"},{default:v((()=>[h("div",Q,[y(s,{modelValue:e.state.formData.link,"onUpdate:modelValue":a[4]||(a[4]=a=>e.state.formData.link=a),placeholder:"请输入引擎地址",onBlur:e.handleLinkInputBlur},null,8,["modelValue","onBlur"]),y(c,{effect:"dark",placement:"bottom"},{content:v((()=>[ee,ae])),default:v((()=>[Z])),_:1})])])),_:1}),y(r,{label:"引擎图标",prop:"iconType"},{default:v((()=>[y(m,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":a[5]||(a[5]=a=>e.state.formData.iconType=a)},{default:v((()=>[(x(!0),f(k,null,P(e.iconTypeList,(e=>(x(),V(d,{label:e.value,key:e.value},{default:v((()=>[I(L(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),"network"===e.state.formData.iconType?(x(),V(r,{key:0,label:"图标地址",prop:"iconPath"},{default:v((()=>[y(m,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":a[7]||(a[7]=a=>e.state.formData.iconType=a)},{default:v((()=>[y(s,{modelValue:e.state.formData.iconPath,"onUpdate:modelValue":a[6]||(a[6]=a=>e.state.formData.iconPath=a),placeholder:"请输入图标地址"},null,8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})):b("",!0),y(r,{label:"图标预览"},{default:v((()=>[h("div",te,[e.showIconPreview?(x(),f(k,{key:0},["network"===e.state.formData.iconType?(x(),f("img",{key:0,src:e.state.formData.iconPath,alt:"icon",width:"24",height:"24"},null,8,ne)):b("",!0),"api"===e.state.formData.iconType?(x(),f("img",{key:1,src:e.tempIconLink,alt:"icon",width:"24",height:"24"},null,8,le)):b("",!0),"text"===e.state.formData.iconType?(x(),f("div",oe,L(e.state.formData.name.slice(0,1)),1)):b("",!0)],64)):(x(),f("div",ie))])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title"])],64)}],["__scopeId","data-v-615de724"]]);export{re as default};
