var Y=Object.defineProperty;var A=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var N=(e,n,c)=>n in e?Y(e,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[n]=c,V=(e,n)=>{for(var c in n||(n={}))G.call(n,c)&&N(e,c,n[c]);if(A)for(var c of A(n))H.call(n,c)&&N(e,c,n[c]);return e};import{D as W}from"./vuedraggable.umd.9c450569.js";import{g as U}from"./images.42219ede.js";import{_ as K,T as Q,a as Z,f as x,j as ee}from"./index.528048ac.js";import{i as oe,r as k,l as ne,o as te,P as ae,j as ie,f as u,h as a,H as s,v as r,x as d,G as m,I as se,F as L,n as le,ac as O,q as y,e as l,N as w,y as ue,z as S,p as re,g as de}from"./vendor.302cf276.js";const ce=[{label:"API\u83B7\u53D6",value:"api"},{label:"\u6587\u5B57\u56FE\u6807",value:"text"},{label:"\u7F51\u7EDC\u56FE\u7247",value:"network"}],pe=oe({name:"EngineConfig",components:{Draggable:W,Tips:Q},props:{engineList:{type:Array,required:!0},backupEngineList:{type:Array,required:!0}},emits:["update"],setup(e,{emit:n}){const c=k(!1),_=k(!1),g=k([]),F=k([]),E=k(""),h=k(),{t:D}=ne();te(()=>{g.value=JSON.parse(JSON.stringify(e.engineList)),F.value=JSON.parse(JSON.stringify(e.backupEngineList))});const C=f=>{const{oldIndex:p}=f,{iconType:i}=g.value[p];i!=="local"&&(_.value=!0)},B=async()=>{await le(),_.value=!1},T=f=>{const{originalEvent:p}=f;let i;if(p.type==="touchend"){const{clientX:v,clientY:b}=p.changedTouches[0];i=document.elementFromPoint(v,b)}else{const{clientX:v,clientY:b}=p;i=document.elementFromPoint(v,b)}if((i==null?void 0:i.className)==="delete-area"&&window.confirm(D("\u662F\u5426\u5220\u9664\u8BE5\u81EA\u5B9A\u4E49\u5F15\u64CE"))){const{newIndex:v}=f;g.value.splice(v,1)}n("update",{engineList:g.value,backupEngineList:F.value})},t=ae({formData:{_id:"",name:"",link:"",iconType:"api",iconPath:""},formRules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0",trigger:"blur"}],link:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740",trigger:"blur"}],iconType:[{required:!0,message:"\u8BF7\u9009\u62E9\u56FE\u6807\u7C7B\u578B",trigger:"change"}],iconPath:[{validator:$,trigger:"blur"}]}});function $(f,p,i){t.formData.iconType==="network"&&!p?i(new Error("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")):i()}const o=k(),P=ie(()=>t.formData.iconType==="api"&&t.formData.link||t.formData.iconType==="network"&&t.formData.iconPath||t.formData.iconType==="text"&&t.formData.name),R=()=>{t.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},h.value.open()},I=()=>{o.value.resetFields(),t.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},h.value.close()},j=()=>{o.value.validate(async f=>{if(f){if(t.formData.iconType==="api"&&E.value)try{const i=await(await fetch(`${x}/api/icon?url=${encodeURIComponent(t.formData.link)}&type=link`)).text();i&&(t.formData.iconType="network",t.formData.iconPath=i)}catch{}if(t.formData._id){const p=g.value.findIndex(i=>i._id===t.formData._id);~p&&(g.value[p]=V({},O(t.formData)))}else t.formData._id=ee(),g.value.push(V({},O(t.formData)));n("update",{engineList:g.value,backupEngineList:F.value}),I()}else return!1})},J=()=>{E.value=U(t.formData.link)},z=f=>{const{_id:p,name:i,link:v,iconType:b,iconPath:X}=f;b!=="local"&&(t.formData={_id:p,name:i,link:v,iconType:b,iconPath:X},h.value.open())},M=Z(!0);return{engineDialog:h,dragDisabled:c,showDeleteArea:_,cloneEngineList:g,cloneBackupEngineList:F,handleDragChoose:C,handleDragUnchoose:B,handleDragEnd:T,handleAddNewEngine:R,handleEditEngine:z,iconTypeList:ce,state:t,form:o,showIconPreview:P,close:I,submit:j,getTargetIcon:U,tempIconLink:E,handleLinkInputBlur:J,dialogOptions:M}}}),q=e=>(re("data-v-5182d6b4"),e=e(),de(),e),me={class:"engine-config",style:{"margin-left":"-100px","padding-bottom":"10px","border-bottom":"1px solid #ccc"}},ge={class:"warning"},fe={class:"content"},he={class:"text s-title"},ye={class:"current-engine-wrapper"},De=["onDblclick","title"],ve=["src"],ke=["src"],Ee={key:2,class:"no-icon"},be={class:"text"},Fe={class:"text s-title"},_e={class:"backup-engine-wrapper"},Te={class:"engine-list-item"},we=["src"],Ce=["src"],Be={key:2,class:"no-icon"},$e={class:"text"},Ve={key:0,class:"delete-area"},Le={class:"form-control"},Pe={class:"tips"},Ie=q(()=>a("b",null,"[0]",-1)),Ae={class:"tips"},Ne=q(()=>a("b",null,"https://juejin.im/search?query=[0]&type=all",-1)),Ue={class:"icon-img-preview-box"},Oe=["src"],Se=["src"],qe={key:2,class:"no-icon"},Re={key:1,class:"icon-img-preview"},je={class:"footer",style:{"text-align":"right",padding:"12px"}};function Je(e,n,c,_,g,F){const E=y("Draggable"),h=y("el-input"),D=y("el-form-item"),C=y("Tips"),B=y("el-radio"),T=y("el-radio-group"),t=y("el-form"),$=y("animation-dialog");return l(),u(L,null,[a("div",me,[a("div",ge,s(e.$t("searchConfigTips")),1),a("div",fe,[a("button",{type:"button",class:"btn btn-primary btn-small btn-add",onClick:n[0]||(n[0]=(...o)=>e.handleAddNewEngine&&e.handleAddNewEngine(...o))},s(e.$t("\u6DFB\u52A0")),1),a("div",he,s(e.$t("\u5F53\u524D\u5F15\u64CE\u7EC4")),1),a("div",ye,[r(E,{modelValue:e.cloneEngineList,"onUpdate:modelValue":n[1]||(n[1]=o=>e.cloneEngineList=o),class:"now-engine-list engine-list","item-key":"name",group:"people",onChoose:e.handleDragChoose,onUnchoose:e.handleDragUnchoose,onEnd:e.handleDragEnd},{item:d(({element:o})=>[a("div",{class:"engine-list-item",onDblclick:P=>e.handleEditEngine(o),title:o.iconType!=="local"?e.$t("\u53CC\u51FB\u91CD\u65B0\u7F16\u8F91"):""},[o.iconType==="local"||o.iconType==="network"?(l(),u("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,ve)):m("",!0),o.iconType==="api"?(l(),u("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,ke)):m("",!0),o.iconType==="text"?(l(),u("div",Ee,s(o.name.slice(0,1)),1)):m("",!0),a("div",be,s(o.name),1)],40,De)]),_:1},8,["modelValue","onChoose","onUnchoose","onEnd"])]),a("div",Fe,s(e.$t("\u5907\u7528\u5F15\u64CE\u7EC4")),1),a("div",_e,[r(E,{modelValue:e.cloneBackupEngineList,"onUpdate:modelValue":n[2]||(n[2]=o=>e.cloneBackupEngineList=o),"item-key":"name",group:"people",class:"backupEngineList engine-list",onEnd:e.handleDragEnd},{item:d(({element:o})=>[a("div",Te,[o.iconType==="local"||o.iconType==="network"?(l(),u("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,we)):m("",!0),o.iconType==="api"?(l(),u("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,Ce)):m("",!0),o.iconType==="text"?(l(),u("div",Be,s(o.name.slice(0,1)),1)):m("",!0),a("div",$e,s(o.name),1)])]),_:1},8,["modelValue","onEnd"]),e.showDeleteArea?(l(),u("div",Ve,s(e.$t("\u62D6\u62FD\u81F3\u6B64\u5904\u5220\u9664")),1)):m("",!0)])])]),r($,se({ref:"engineDialog",animationMode:"",title:`${e.state.formData._id?e.$t("\u7F16\u8F91"):e.$t("\u6DFB\u52A0")}${e.$t("\u81EA\u5B9A\u4E49\u5F15\u64CE")}`,width:"min(380px, 90vw)",height:"min(460px, 80vh)",customClass:"add-engine-dialog",closeOnClickOutside:!1,listenWindowSizeChange:"",appendToBody:""},e.dialogOptions),{footer:d(()=>[a("div",je,[a("button",{type:"button",class:"btn",onClick:n[8]||(n[8]=(...o)=>e.close&&e.close(...o))},s(e.$t("\u53D6\u6D88")),1),a("button",{type:"button",class:"btn btn-primary",onClick:n[9]||(n[9]=(...o)=>e.submit&&e.submit(...o))},s(e.$t("\u786E\u8BA4")),1)])]),default:d(()=>[r(t,{ref:"form","label-width":"90px",model:e.state.formData,rules:e.state.formRules},{default:d(()=>[r(D,{label:e.$t("\u5F15\u64CE\u540D\u79F0"),prop:"name"},{default:d(()=>[r(h,{modelValue:e.state.formData.name,"onUpdate:modelValue":n[3]||(n[3]=o=>e.state.formData.name=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(D,{label:e.$t("\u5F15\u64CE\u5730\u5740"),prop:"link"},{default:d(()=>[a("div",Le,[r(h,{modelValue:e.state.formData.link,"onUpdate:modelValue":n[4]||(n[4]=o=>e.state.formData.link=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740"),onBlur:e.handleLinkInputBlur},null,8,["modelValue","placeholder","onBlur"]),r(C,null,{default:d(()=>[a("div",Pe,[w(s(e.$t("engineConfigTips1"))+" ",1),Ie,w(" "+s(e.$t("engineConfigTips2")),1)]),a("div",Ae,[w(s(e.$t("\u4F8B\u5982"))+": ",1),Ne])]),_:1})])]),_:1},8,["label"]),r(D,{label:e.$t("\u5F15\u64CE\u56FE\u6807"),prop:"iconType"},{default:d(()=>[r(T,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[5]||(n[5]=o=>e.state.formData.iconType=o)},{default:d(()=>[(l(!0),u(L,null,ue(e.iconTypeList,o=>(l(),S(B,{label:o.value,key:o.value},{default:d(()=>[w(s(e.$t(o.label)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.state.formData.iconType==="network"?(l(),S(D,{key:0,label:e.$t("\u56FE\u6807\u5730\u5740"),prop:"iconPath"},{default:d(()=>[r(T,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[7]||(n[7]=o=>e.state.formData.iconType=o)},{default:d(()=>[r(h,{modelValue:e.state.formData.iconPath,"onUpdate:modelValue":n[6]||(n[6]=o=>e.state.formData.iconPath=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue"])]),_:1},8,["label"])):m("",!0),r(D,{label:e.$t("\u56FE\u6807\u9884\u89C8")},{default:d(()=>[a("div",Ue,[e.showIconPreview?(l(),u(L,{key:0},[e.state.formData.iconType==="network"?(l(),u("img",{key:0,src:e.state.formData.iconPath,alt:"icon",width:"24",height:"24"},null,8,Oe)):m("",!0),e.state.formData.iconType==="api"?(l(),u("img",{key:1,src:e.tempIconLink,alt:"icon",width:"24",height:"24"},null,8,Se)):m("",!0),e.state.formData.iconType==="text"?(l(),u("div",qe,s(e.state.formData.name.slice(0,1)),1)):m("",!0)],64)):(l(),u("div",Re))])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},16,["title"])],64)}var He=K(pe,[["render",Je],["__scopeId","data-v-5182d6b4"]]);export{He as default};
