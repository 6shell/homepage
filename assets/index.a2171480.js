var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,a=(e,a)=>{for(var s in a||(a={}))n.call(a,s)&&o(e,s,a[s]);if(t)for(var s of t(a))i.call(a,s)&&o(e,s,a[s]);return e};"undefined"!=typeof require&&require;import{u as s,m as r,c as d}from"./index.cfda32d7.js";import{d as l,c,r as u,b as g,B as y,o as p,ae as k,M as m,p as f,l as v,z as h,e as b,E as S,L as C,F as I,h as w,O as x,H as M,u as K,m as O,j as E,t as A,D as j,q as L,s as B,ad as R}from"./element-plus.abf3c969.js";const T={tab:{span:1},Q:{keyCode:81},W:{keyCode:87},E:{keyCode:69},R:{keyCode:82},T:{keyCode:84},Y:{keyCode:89},U:{keyCode:85},I:{keyCode:73},O:{keyCode:79},P:{keyCode:80},brackets:{span:1},caps:{span:2},A:{keyCode:65},S:{keyCode:83},D:{keyCode:68},F:{keyCode:70},G:{keyCode:71},H:{keyCode:72},J:{keyCode:74},K:{keyCode:75},L:{keyCode:76},semi:{span:2},shift:{span:3},Z:{keyCode:90},X:{keyCode:88},C:{keyCode:67},V:{keyCode:86},B:{keyCode:66},N:{keyCode:78},M:{keyCode:77}};function U(e){return new Promise(((t,n)=>{(function(e,t="image/png",n,i){return new Promise(((o,a)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",i&&(s.timeout=i),s.onload=()=>{if(200===s.status){const e=new Uint8Array(s.response);let n=e.length;const i=new Array(n);for(;n--;)i[n]=String.fromCharCode(e[n]);const a=i.join(""),r=window.btoa(a);o("data:"+(t||"image/png")+";base64,"+r)}},s.onerror=e=>{a(e)},s.onprogress=e=>{n&&n(e)},i&&(s.ontimeout=e=>{s.abort(),a(e)}),s.send()}))})(`https://favicon.cccyun.cc/${e}`,"image/x-icon",null,5e3).then((e=>{const i=new Image;i.src=e,i.onload=()=>{const e=document.createElement("canvas"),n=e.getContext("2d"),o=i.width>32?32:i.width,a=i.height>32?32:i.height;e.width=o,e.height=a,n.drawImage(i,0,0,o,a);const s=n.getImageData(0,0,o,a),[r,d,l,c]=[255,255,255,255];for(let t=0;t<s.data.length;t+=4){const e=s.data[t],n=s.data[t+1],i=s.data[t+2],o=s.data[t+3];Math.sqrt((e-r)**2+(n-d)**2+(i-l)**2+(o-c)**2)<=0&&(s.data[t]=0,s.data[t+1]=0,s.data[t+2]=0,s.data[t+3]=0)}n.putImageData(s,0,0);const u=e.toDataURL("image/png");t(u)},i.onerror=e=>{n(e)}}),(e=>{n(e)}))}))}var q=l({name:"Collection",props:{componentSetting:{type:Object,required:!0},element:{type:Object,required:!0}},setup(e){const t=s(),n=c((()=>e.componentSetting.userSettingKeyMap||{})),i=c((()=>r(e.componentSetting.position))),o=u({editingActive:!1,editingInfo:{key:"",url:"",remark:""}}),a=g(!1),l=i=>{if(!e.componentSetting.useKeyboardEvent)return;if(!t.state.isLock)return;if(document.querySelector("input:focus")||document.querySelector("textarea:focus"))return;const o=i.keyCode,a=Object.keys(T).find((e=>T[e].keyCode===o));a&&n.value[a]&&window.open(n.value[a].url)};y((()=>{document.addEventListener("keydown",l)})),p((()=>{document.removeEventListener("keydown",l)}));const f=g(),v=()=>{o.editingInfo.key="",o.editingInfo.url="",o.editingInfo.remark="",o.editingActive=!1},h=g(!1),b=n=>{const i=JSON.parse(JSON.stringify(m(e.element)));i.componentSetting.userSettingKeyMap=n,t.commit("editComponent",i)};return{keyboardMap:T,userSettingKeyMap:n,handleKeyClick:(e,t)=>{t&&n.value[t]?window.open(n.value[t].url):(f.value.open(e.currentTarget),o.editingInfo.key=t,setTimeout((()=>{o.editingActive=!0,a.value=!0}),200))},handleDialogClose:v,showDialog:(e,t)=>{var i,s;const r=null==(s=null==(i=null==e?void 0:e.currentTarget)?void 0:i.parentNode)?void 0:s.parentNode;f.value.open(r),o.editingInfo.key=t;const{url:d,remark:l}=n.value[t];o.editingInfo.url=d,o.editingInfo.remark=l,setTimeout((()=>{o.editingActive=!0,a.value=!0}),200)},editState:o,clearEidtInfo:()=>{if(o.editingInfo.url&&o.editingInfo.remark&&confirm("确定清除该按键绑定的网页吗?")){o.editingInfo.url="",o.editingInfo.remark="";const e=k(n);delete e[o.editingInfo.key],b(e),v(),f.value.close()}},handleImgError:e=>{const t=e.currentTarget;t.style.visibility="hidden",t.nextElementSibling.style.visibility="visible"},handleUserKeySave:async()=>{if(o.editingInfo.url&&o.editingInfo.remark)if(/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(o.editingInfo.url)){/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(o.editingInfo.url)||(o.editingInfo.url="https://"+o.editingInfo.url),h.value=!0;let[e,t]=await d(U(o.editingInfo.url));e&&(t=`https://favicon.cccyun.cc/${o.editingInfo.url}`);const i=JSON.parse(JSON.stringify(n.value));i[o.editingInfo.key]={url:o.editingInfo.url,remark:o.editingInfo.remark,icon:t},b(i),setTimeout((()=>{v(),h.value=!1,f.value.close()}),400)}else window.alert("URL地址不正确")},saveLoading:h,dialog:f,positionCSS:i,dialogFooterVisible:a}}});f("data-v-8c101e44");const z=["onClick"],D={class:"keys"},V={class:"keys-name"},N=["onClick"],_=[C("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"14",height:"14"},[C("path",{d:"M231.08266667 509.49688889c-0.11377778 51.76888889-41.87022222 93.52533333-93.75288889 93.41155556-51.65511111-0.11377778-93.63911111-42.09777778-93.52533333-93.86666667 0-51.54133333 42.21155555-93.52533333 93.98044444-93.41155556 51.65511111 0.11377778 93.29777778 41.984 93.29777778 93.86666667z m656.49777778-93.75288889c51.76888889 0 93.86666667 41.87022222 93.86666666 93.52533333 0.11377778 51.65511111-41.87022222 93.75288889-93.63911111 93.75288889-51.88266667 0-93.75288889-41.64266667-93.75288889-93.52533333s41.64266667-93.75288889 93.52533334-93.75288889zM512.45511111 603.02222222c-51.65511111 0-93.98044445-42.43911111-93.75288889-93.75288889 0.34133333-51.76888889 42.21155555-93.52533333 93.98044445-93.52533333 51.65511111 0 93.86666667 42.21155555 93.63911111 93.75288889-0.11377778 51.65511111-42.09777778 93.52533333-93.86666667 93.52533333z"})],-1)],P={key:1,class:"plus-box"},F=[C("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"20",height:"20"},[C("path",{d:"M896 469.333333H554.666667V128a42.666667 42.666667 0 0 0-85.333334 0v341.333333H128a42.666667 42.666667 0 0 0 0 85.333334h341.333333v341.333333a42.666667 42.666667 0 0 0 85.333334 0V554.666667h341.333333a42.666667 42.666667 0 0 0 0-85.333334z"})],-1)],H={key:2,class:"icon-box"},J=["src"],Z={class:"no-icon",style:{visibility:"hidden"}},$={key:3,class:"mark-text"},G={class:"keys-wrapper",style:{width:"9.08%"}},W=[C("div",{class:"keys"},null,-1)],X={class:"editing-key"},Q=C("div",{class:"label"},"URL",-1),Y=C("div",{class:"line"},null,-1),ee=C("div",{class:"label"},"Remark",-1),te=C("div",{class:"line"},null,-1),ne={key:0,class:"footer",style:{"text-align":"right",padding:"12px"}},ie=["disabled"],oe=["loading"];v(),q.render=function(e,t,n,i,o,s){const r=h("animation-dialog");return b(),S("div",{class:"wrapper",style:M(a({},e.positionCSS))},[C("div",{class:"keyboard-mode",style:M({maxWidth:e.componentSetting.keyboardMaxWidth+"px"})},[(b(!0),S(I,null,w(e.keyboardMap,((n,i)=>(b(),S("div",{class:x(["keys-wrapper",{hidden:n.span}]),key:i,style:M({width:(n.span?4.5*n.span:9)+"%",padding:`${e.componentSetting.keyGutter}px`})},[C("div",{class:"keys-box",onClick:t=>e.handleKeyClick(t,i),style:M({background:e.componentSetting.keyBackground,borderRadius:e.componentSetting.keyBorderRadius})},[C("div",D,[C("div",V,K(i),1),e.userSettingKeyMap[i]?(b(),S("div",{key:0,class:"edit-icon-box",onClick:O((t=>e.showDialog(t,i)),["stop"])},_,8,N)):E("",!0),e.userSettingKeyMap[i]?E("",!0):(b(),S("div",P,F)),e.userSettingKeyMap[i]?(b(),S("div",H,[C("img",{class:"icon",src:e.userSettingKeyMap[i].icon||`https://favicon.cccyun.cc/${e.userSettingKeyMap[i].url}`,alt:"link",onError:t[0]||(t[0]=(...t)=>e.handleImgError&&e.handleImgError(...t))},null,40,J),C("div",Z,K(e.userSettingKeyMap[i].remark.slice(0,1)),1)])):E("",!0),e.userSettingKeyMap[i]&&e.userSettingKeyMap[i].remark?(b(),S("div",$,K(e.userSettingKeyMap[i].remark),1)):E("",!0)])],12,z)],6)))),128)),C("div",G,[C("div",{class:"keys-box",style:M({background:e.componentSetting.keyBackground,borderRadius:e.componentSetting.keyBorderRadius})},W,4)])],4),A(r,{ref:"dialog",width:"300px",height:"330px",appendToBody:"",closeOnClickOutside:!1,onBeforeClose:t[6]||(t[6]=t=>e.dialogFooterVisible=!1),onClose:e.handleDialogClose},{footer:j((()=>[e.dialogFooterVisible?(b(),S("div",ne,[C("button",{type:"button",class:"btn",disabled:!e.editState.editingInfo.url&&!e.editState.editingInfo.remark,onClick:t[4]||(t[4]=(...t)=>e.clearEidtInfo&&e.clearEidtInfo(...t))},"清空",8,ie),C("button",{type:"button",class:"btn btn-primary",loading:e.saveLoading,onClick:t[5]||(t[5]=(...t)=>e.handleUserKeySave&&e.handleUserKeySave(...t))},"确认",8,oe)])):E("",!0)])),default:j((()=>[L(C("div",{class:"edit-content",onKeydown:t[3]||(t[3]=O((()=>{}),["stop"]))},[C("div",X,K(e.editState.editingInfo.key),1),C("div",{class:x(["row-input",{active:e.editState.editingInfo.url.length>0}])},[L(C("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=t=>e.editState.editingInfo.url=t)},null,512),[[R,e.editState.editingInfo.url]]),Q,Y],2),C("div",{class:x(["row-input",{active:e.editState.editingInfo.remark.length>0}])},[L(C("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=t=>e.editState.editingInfo.remark=t)},null,512),[[R,e.editState.editingInfo.remark]]),ee,te],2)],544),[[B,e.editState.editingActive]])])),_:1},8,["onClose"])],4)},q.__scopeId="data-v-8c101e44";export default q;
