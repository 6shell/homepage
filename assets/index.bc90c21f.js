var $=Object.defineProperty;var V=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var T=(e,t,i)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,U=(e,t)=>{for(var i in t||(t={}))Z.call(t,i)&&T(e,i,t[i]);if(V)for(var i of V(t))H.call(t,i)&&T(e,i,t[i]);return e};import{i as P,j as z,l as G,P as W,r as I,o as Q,b as X,f as u,h as n,F as Y,y as x,D as k,v as ee,x as D,u as te,ac as oe,q as ne,e as c,B as b,H as y,af as L,G as m,A as w,ah as ie,ag as N,p as se,g as ae}from"./vendor.81fc964e.js";import{_ as de,u as re,m as le,g as ue}from"./index.4b5728d4.js";import{a as O,b as ce}from"./images.41da6cf9.js";const M={tab:{span:1},Q:{keyCode:81},W:{keyCode:87},E:{keyCode:69},R:{keyCode:82},T:{keyCode:84},Y:{keyCode:89},U:{keyCode:85},I:{keyCode:73},O:{keyCode:79},P:{keyCode:80},brackets:{span:1},caps:{span:2},A:{keyCode:65},S:{keyCode:83},D:{keyCode:68},F:{keyCode:70},G:{keyCode:71},H:{keyCode:72},J:{keyCode:74},K:{keyCode:75},L:{keyCode:76},semi:{span:2},shift:{span:3},Z:{keyCode:90},X:{keyCode:88},C:{keyCode:67},V:{keyCode:86},B:{keyCode:66},N:{keyCode:78},M:{keyCode:77}};const ge=P({name:"Collection",props:{componentSetting:{type:Object,required:!0},element:{type:Object,required:!0},isAction:{type:Boolean,default:!1}},setup(e){const t=re(),i=z(()=>e.componentSetting.userSettingKeyMap||{}),K=z(()=>le(e.componentSetting.position)),{t:S}=G(),o=W({editingActive:!1,editingInfo:{key:"",url:"",remark:""}}),f=I(!1),r=s=>{if(!e.componentSetting.useKeyboardEvent||!t.isLock||document.querySelector("input:focus")||document.querySelector("textarea:focus")||document.querySelector(".ProseMirror-focused")||document.querySelector(".action-popover"))return;const a=s.keyCode,l=Object.keys(M).find(v=>M[v].keyCode===a);l&&i.value[l]&&_(i.value[l].url)};Q(()=>{document.addEventListener("keydown",r)}),X(()=>{document.removeEventListener("keydown",r)});const d=I(),g=(s,a)=>{a&&i.value[a]?_(i.value[a].url):(d.value.open(s.currentTarget),o.editingInfo.key=a,setTimeout(()=>{o.editingActive=!0,f.value=!0},200))},h=()=>{o.editingInfo.key="",o.editingInfo.url="",o.editingInfo.remark="",o.editingActive=!1},R=(s,a)=>{var A,B;const l=(B=(A=s==null?void 0:s.currentTarget)==null?void 0:A.parentNode)==null?void 0:B.parentNode;d.value.open(l),o.editingInfo.key=a;const{url:v,remark:J}=i.value[a];o.editingInfo.url=v,o.editingInfo.remark=J,setTimeout(()=>{o.editingActive=!0,f.value=!0},200)},q=()=>{if(o.editingInfo.url&&o.editingInfo.remark&&confirm(S("\u786E\u5B9A\u6E05\u9664\u8BE5\u6309\u952E\u7ED1\u5B9A\u7684\u7F51\u9875\u5417?"))){o.editingInfo.url="",o.editingInfo.remark="";const s=te(i);delete s[o.editingInfo.key],E(s),h(),d.value.close()}},C=I(!1),F=async()=>{if(!(!o.editingInfo.url||!o.editingInfo.remark))if(/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(o.editingInfo.url)){/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(o.editingInfo.url)||(o.editingInfo.url="https://"+o.editingInfo.url),C.value=!0;let[s,a]=await ue(ce(O(o.editingInfo.url)));s&&(a=`${new URL(o.editingInfo.url).origin}/favicon.ico`);const l=JSON.parse(JSON.stringify(i.value));l[o.editingInfo.key]={url:o.editingInfo.url,remark:o.editingInfo.remark,icon:a},E(l),setTimeout(()=>{h(),C.value=!1,d.value.close()},400)}else window.alert(S("URL\u5730\u5740\u4E0D\u6B63\u786E"))},j=s=>{const a=s.currentTarget;a.style.visibility="hidden",a.nextElementSibling.style.visibility="inherit"},E=s=>{const a=JSON.parse(JSON.stringify(oe(e.element)));e.isAction?(a.actionSetting.actionClickValue.componentSetting.userSettingKeyMap=s,t.updateActionElement(a)):a.componentSetting.userSettingKeyMap=s,t.editComponent(a)},_=s=>{e.componentSetting.jumpType===2?window.location.href=s:window.open(s)};return{keyboardMap:M,userSettingKeyMap:i,handleKeyClick:g,handleDialogClose:h,showDialog:R,editState:o,clearEidtInfo:q,handleImgError:j,handleUserKeySave:F,saveLoading:C,dialog:d,positionCSS:K,dialogFooterVisible:f,getTargetIconV2:O}}}),p=e=>(se("data-v-4b0c0b68"),e=e(),ae(),e),pe=["onClick"],ye={class:"keys"},fe={class:"keys-name"},ke=["onClick"],me=p(()=>n("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"14",height:"14"},[n("path",{d:"M231.08266667 509.49688889c-0.11377778 51.76888889-41.87022222 93.52533333-93.75288889 93.41155556-51.65511111-0.11377778-93.63911111-42.09777778-93.52533333-93.86666667 0-51.54133333 42.21155555-93.52533333 93.98044444-93.41155556 51.65511111 0.11377778 93.29777778 41.984 93.29777778 93.86666667z m656.49777778-93.75288889c51.76888889 0 93.86666667 41.87022222 93.86666666 93.52533333 0.11377778 51.65511111-41.87022222 93.75288889-93.63911111 93.75288889-51.88266667 0-93.75288889-41.64266667-93.75288889-93.52533333s41.64266667-93.75288889 93.52533334-93.75288889zM512.45511111 603.02222222c-51.65511111 0-93.98044445-42.43911111-93.75288889-93.75288889 0.34133333-51.76888889 42.21155555-93.52533333 93.98044445-93.52533333 51.65511111 0 93.86666667 42.21155555 93.63911111 93.75288889-0.11377778 51.65511111-42.09777778 93.52533333-93.86666667 93.52533333z"})],-1)),ve=[me],Se={key:1,class:"plus-box"},he=p(()=>n("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"20",height:"20"},[n("path",{d:"M896 469.333333H554.666667V128a42.666667 42.666667 0 0 0-85.333334 0v341.333333H128a42.666667 42.666667 0 0 0 0 85.333334h341.333333v341.333333a42.666667 42.666667 0 0 0 85.333334 0V554.666667h341.333333a42.666667 42.666667 0 0 0 0-85.333334z"})],-1)),Ce=[he],Ie={key:2,class:"icon-box"},be=["src"],we={class:"no-icon",style:{visibility:"hidden"}},Me={key:3,class:"mark-text"},Ke={class:"keys-wrapper",style:{width:"9.08%"}},Ee=p(()=>n("div",{class:"keys"},null,-1)),_e=[Ee],Ae={class:"editing-key"},Be=p(()=>n("div",{class:"label"},"URL",-1)),Ve=p(()=>n("div",{class:"line"},null,-1)),Te=p(()=>n("div",{class:"label"},"Remark",-1)),Ue=p(()=>n("div",{class:"line"},null,-1)),ze={key:0,class:"footer",style:{"text-align":"right",padding:"12px"}},De=["disabled"],Le=["loading"];function Ne(e,t,i,K,S,o){const f=ne("animation-dialog");return c(),u("div",{class:"wrapper",style:k(U({},e.positionCSS))},[n("div",{class:"keyboard-mode",style:k({maxWidth:e.componentSetting.keyboardMaxWidth+"px"})},[(c(!0),u(Y,null,x(e.keyboardMap,(r,d)=>(c(),u("div",{class:b(["keys-wrapper",{hidden:r.span}]),key:d,style:k({width:`${r.span?r.span*4.5:9}%`,padding:`${e.componentSetting.keyGutter}px`})},[n("div",{class:"keys-box",onClick:g=>e.handleKeyClick(g,d),style:k({background:e.componentSetting.keyBackground,borderRadius:e.componentSetting.keyBorderRadius})},[n("div",ye,[n("div",fe,y(d),1),e.userSettingKeyMap[d]?(c(),u("div",{key:0,class:"edit-icon-box",onClick:L(g=>e.showDialog(g,d),["stop"])},ve,8,ke)):m("",!0),e.userSettingKeyMap[d]?m("",!0):(c(),u("div",Se,Ce)),e.userSettingKeyMap[d]?(c(),u("div",Ie,[n("img",{class:"icon",src:e.userSettingKeyMap[d].icon||e.getTargetIconV2(e.userSettingKeyMap[d].url),alt:"link",onError:t[0]||(t[0]=(...g)=>e.handleImgError&&e.handleImgError(...g))},null,40,be),n("div",we,y(e.userSettingKeyMap[d].remark.slice(0,1)),1)])):m("",!0),e.userSettingKeyMap[d]&&e.userSettingKeyMap[d].remark?(c(),u("div",Me,y(e.userSettingKeyMap[d].remark),1)):m("",!0)])],12,pe)],6))),128)),n("div",Ke,[n("div",{class:"keys-box",style:k({background:e.componentSetting.keyBackground,borderRadius:e.componentSetting.keyBorderRadius})},_e,4)])],4),ee(f,{ref:"dialog",width:"300px",height:"330px",appendToBody:"",closeOnClickOutside:!1,onBeforeClose:t[6]||(t[6]=r=>e.dialogFooterVisible=!1),onClose:e.handleDialogClose},{footer:D(()=>[e.dialogFooterVisible?(c(),u("div",ze,[n("button",{type:"button",class:"btn",disabled:!e.editState.editingInfo.url&&!e.editState.editingInfo.remark,onClick:t[4]||(t[4]=(...r)=>e.clearEidtInfo&&e.clearEidtInfo(...r))},y(e.$t("\u6E05\u7A7A")),9,De),n("button",{type:"button",class:"btn btn-primary",loading:e.saveLoading,onClick:t[5]||(t[5]=(...r)=>e.handleUserKeySave&&e.handleUserKeySave(...r))},y(e.$t("\u786E\u8BA4")),9,Le)])):m("",!0)]),default:D(()=>[w(n("div",{class:"edit-content",onKeydown:t[3]||(t[3]=L(()=>{},["stop"]))},[n("div",Ae,y(e.editState.editingInfo.key),1),n("div",{class:b(["row-input",{active:e.editState.editingInfo.url.length>0}])},[w(n("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>e.editState.editingInfo.url=r)},null,512),[[N,e.editState.editingInfo.url]]),Be,Ve],2),n("div",{class:b(["row-input",{active:e.editState.editingInfo.remark.length>0}])},[w(n("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=r=>e.editState.editingInfo.remark=r)},null,512),[[N,e.editState.editingInfo.remark]]),Te,Ue],2)],544),[[ie,e.editState.editingActive]])]),_:1},8,["onClose"])],4)}var je=de(ge,[["render",Ne],["__scopeId","data-v-4b0c0b68"]]);export{je as default};
