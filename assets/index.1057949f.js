import{t as e,a as t,_ as n,I as r,r as s,c as i,i as o,p as a,k as c,n as l,m as u,S as d,s as p,v as f,N as h,O as m,w as v,Q as g}from"./index.32e3b344.js";import"./index.1ee3e23f.js";import"./color.556e4bcb.js";const y=e=>Object.prototype.hasOwnProperty.call(e,"origin");class b extends Array{findThenRun(e,t){const n=this.findIndex((t=>y(t)&&t.origin===e));return n<0||t(n),this}configure(e,t){return this.findThenRun(e,(n=>{this.splice(n,1,e(t))}))}replace(e,t){return this.findThenRun(e,(e=>{this.splice(e,1,t)}))}remove(e){return this.findThenRun(e,(e=>{this.splice(e,1)}))}headless(){return this.filter(y).forEach((e=>{this.configure(e.origin,{headless:!0})})),this}static create(e){return new b(...e)}}const j=h=>((e,t,n)=>{const r=t;return r.extend=t=>n(((...n)=>t(e(...n),...n))),r})(h,(e=>{const t=n=>{const r=e(n);return r.origin=t,r};return t})((m=>()=>v=>n(void 0,void 0,void 0,(function*(){const g=((n,r)=>{try{const t=n.get(e);return{getClassName:(s=null==r?void 0:r.className,(e,...t)=>{var n;const r=null!==(n=null==s?void 0:s(e))&&void 0!==n?n:t;return Array.isArray(r)?r.filter((e=>e)).join(" "):r}),getStyle:e=>(null==r?void 0:r.headless)?"":e(t),themeTool:t}}catch(i){throw t()}var s})(v,m),y=h(g,m);if(yield((e,t,l,u)=>n(void 0,void 0,void 0,(function*(){if(yield e.wait(r),t.remarkPlugins){const n=t.remarkPlugins(e);e.update(s,(e=>[...e,...n]))}const n=yield l();if(t.commands&&t.commands(n,e).forEach((([t,n])=>{e.get(i).create(t,n)})),t.inputRules){const r=t.inputRules(n,e);e.update(o,(e=>[...e,...r]))}if(t.shortcuts){const n=(e,t)=>{var n,r;return null!==(r=null===(n=null==u?void 0:u.keymap)||void 0===n?void 0:n[e])&&void 0!==r?r:t},r=Object.entries(t.shortcuts).flatMap((([t,[r,s,o]])=>{const a=()=>e.get(i).call(r,o),c=n(t,s);return Array.isArray(c)?c.map((e=>({key:e,runner:a}))):{key:c,runner:a}})).map((e=>[e.key,e.runner]));e.update(a,(e=>e.concat(c(Object.fromEntries(r)))))}if(t.prosePlugins){const r=t.prosePlugins(n,e);e.update(a,(e=>[...e,...r]))}})))(v,y,(()=>n(void 0,void 0,void 0,(function*(){let e={},t={};if(y.schema){const n=y.schema(v);if(n.node){e=n.node;const t=Object.entries(n.node);v.update(l,(e=>[...e,...t]))}if(n.mark){t=n.mark;const e=Object.entries(n.mark);v.update(u,(t=>[...t,...e]))}}yield v.wait(d);const n=v.get(p),r=Object.keys(e).map((e=>[e,n.nodes[e]])),s=Object.keys(t).map((e=>[e,n.marks[e]]));return Object.fromEntries([...r,...s])}))),m),y.view){const e=y.view(v);v.update(f,(t=>[...t,...Object.entries(e)]))}})))),j),k=e=>{if(!e)return!1;if(Array.isArray(e))return!(e.length>1)&&k(e[0]);const t=e.content;return t?k(t):"text"===e.type},O=j((()=>({prosePlugins:(e,t)=>{const n=t.get(p),r=t.get(h),s=t.get(m);return[new v({props:{handlePaste:(e,t)=>{var n,s;const i=null===(s=(n=e.props).editable)||void 0===s?void 0:s.call(n,e.state),{clipboardData:o}=t;if(!i||!o)return!1;const a=o.getData("text/plain");if(o.getData("text/html").length>0)return!1;const c=r(a);if(!c||"string"==typeof c)return!1;const l=e.state.selection.content();return e.dispatch(e.state.tr.replaceSelection(new g(c.content,l.openStart,l.openEnd))),!0},clipboardTextSerializer:e=>{if(k(e.content.toJSON()))return e.content.textBetween(0,e.content.size,"\n\n");const t=n.topNodeType.createAndFill(void 0,e.content);if(!t)return"";return s(t)}}})]}}))),w=b.create([O()]);export{w as clipboard,O as clipboardPlugin};
