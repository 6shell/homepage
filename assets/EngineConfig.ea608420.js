var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(a,t,n)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,o=(e,o)=>{for(var i in o||(o={}))t.call(o,i)&&l(e,i,o[i]);if(a)for(var i of a(o))n.call(o,i)&&l(e,i,o[i]);return e};import{D as i}from"./vuedraggable.umd.2c38539d.js";import{g as s}from"./images.9f7a1667.js";import{_ as r,d as c,r as d,G as m,a as p,L as u,k as g,f,g as h,w as y,x as v,F as b,a1 as k,V as D,t as w,a4 as T,z as E,A as _,e as x,o as L,v as P,l as V,c as I,s as C}from"./index.d3e40f7f.js";const O=[{label:"API获取",value:"api"},{label:"文字图标",value:"text"},{label:"网络图片",value:"network"}],U=c({name:"EngineConfig",components:{Draggable:i},props:{engineList:{type:Array,required:!0},backupEngineList:{type:Array,required:!0}},emits:["update"],setup(e,{emit:a}){const t=d(!1),n=d(!1),l=d([]),i=d([]),r=d(""),c=d();m((()=>{l.value=JSON.parse(JSON.stringify(e.engineList)),i.value=JSON.parse(JSON.stringify(e.backupEngineList))}));const g=p({formData:{_id:"",name:"",link:"",iconType:"api",iconPath:""},formRules:{name:[{required:!0,message:"请输入引擎名称",trigger:"blur"}],link:[{required:!0,message:"请输入引擎地址",trigger:"blur"}],iconType:[{required:!0,message:"请选择图标类型",trigger:"change"}],iconPath:[{validator:function(e,a,t){"network"!==g.formData.iconType||a?t():t(new Error("请输入图标地址"))},trigger:"blur"}]}});const f=d(),h=u((()=>"api"===g.formData.iconType&&g.formData.link||"network"===g.formData.iconType&&g.formData.iconPath||"text"===g.formData.iconType&&g.formData.name)),y=()=>{f.value.resetFields(),g.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},c.value.close()};return{engineDialog:c,dragDisabled:t,showDeleteArea:n,cloneEngineList:l,cloneBackupEngineList:i,handleDragChoose:e=>{const{oldIndex:a}=e,{iconType:t}=l.value[a];"local"!==t&&(n.value=!0)},handleDragUnchoose:async()=>{await k(),n.value=!1},handleDragEnd:e=>{const{originalEvent:t}=e;let n;if("touchend"===t.type){const{clientX:e,clientY:a}=t.changedTouches[0];n=document.elementFromPoint(e,a)}else{const{clientX:e,clientY:a}=t;n=document.elementFromPoint(e,a)}if("delete-area"===(null==n?void 0:n.className)&&window.confirm("是否删除该自定义引擎")){const{newIndex:a}=e;l.value.splice(a,1)}a("update",{engineList:l.value,backupEngineList:i.value})},handleAddNewEngine:()=>{g.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},c.value.open()},handleEditEngine:e=>{const{_id:a,name:t,link:n,iconType:l,iconPath:o}=e;"local"!==l&&(g.formData={_id:a,name:t,link:n,iconType:l,iconPath:o},c.value.open())},iconTypeList:O,state:g,form:f,showIconPreview:h,close:y,submit:()=>{f.value.validate((async e=>{if(!e)return!1;if("api"===g.formData.iconType&&r.value)try{const e=await fetch(`${D}/api/icon?url=${encodeURIComponent(g.formData.link)}&type=link`),a=await e.text();a&&(g.formData.iconType="network",g.formData.iconPath=a)}catch{}if(g.formData._id){const e=l.value.findIndex((e=>e._id===g.formData._id));~e&&(l.value[e]=o({},w(g.formData)))}else g.formData._id=T(),l.value.push(o({},w(g.formData)));a("update",{engineList:l.value,backupEngineList:i.value}),y()}))},getTargetIcon:s,tempIconLink:r,handleLinkInputBlur:()=>{r.value=s(g.formData.link)}}}}),j=e=>(E("data-v-b7861120"),e=e(),_(),e),A={class:"engine-config",style:{"margin-left":"-100px","padding-bottom":"10px","border-bottom":"1px solid #ccc"}},B=j((()=>f("div",{class:"warning"},"拖拽下方图标可更换引擎顺序，也可添加自定义引擎，对于自定义引擎双击图标重新编辑",-1))),N={class:"content"},q=j((()=>f("div",{class:"text s-title"},"当前引擎组",-1))),S={class:"current-engine-wrapper"},F=["onDblclick","title"],J=["src"],R=["src"],z={key:2,class:"no-icon"},X={class:"text"},Y=j((()=>f("div",{class:"text s-title"},"备用引擎组",-1))),$={class:"backup-engine-wrapper"},G={class:"engine-list-item"},M=["src"],W=["src"],H={key:2,class:"no-icon"},K={class:"text"},Q={key:0,class:"delete-area"},Z={class:"form-control"},ee=j((()=>f("i",{class:"tips el-icon-warning-outline"},null,-1))),ae=j((()=>f("div",{class:"tips"},[C("默认搜索内容会被拼接到引擎地址末尾, 也可以使用 "),f("b",null,"[0]"),C(" 对原地址搜索关键词进行占位")],-1))),te=j((()=>f("div",{class:"tips"},[C("例如: "),f("b",null,"https://juejin.im/search?query=[0]&type=all")],-1))),ne={class:"icon-img-preview-box"},le=["src"],oe=["src"],ie={key:2,class:"no-icon"},se={key:1,class:"icon-img-preview"},re={class:"footer",style:{"text-align":"right",padding:"12px"}};var ce=r(U,[["render",function(e,a,t,n,l,o){const i=x("Draggable"),s=x("el-input"),r=x("el-form-item"),c=x("el-tooltip"),d=x("el-radio"),m=x("el-radio-group"),p=x("el-form"),u=x("animation-dialog");return L(),g(b,null,[f("div",A,[B,f("div",N,[f("button",{type:"button",class:"btn btn-primary btn-small btn-add",onClick:a[0]||(a[0]=(...a)=>e.handleAddNewEngine&&e.handleAddNewEngine(...a))},"添加"),q,f("div",S,[h(i,{modelValue:e.cloneEngineList,"onUpdate:modelValue":a[1]||(a[1]=a=>e.cloneEngineList=a),class:"now-engine-list engine-list","item-key":"name",group:"people",onChoose:e.handleDragChoose,onUnchoose:e.handleDragUnchoose,onEnd:e.handleDragEnd},{item:y((({element:a})=>[f("div",{class:"engine-list-item",onDblclick:t=>e.handleEditEngine(a),title:"local"!==a.iconType?"双击重新编辑":""},["local"===a.iconType||"network"===a.iconType?(L(),g("img",{key:0,src:a.iconPath,alt:"icon",width:"24",height:"24"},null,8,J)):v("",!0),"api"===a.iconType?(L(),g("img",{key:1,src:e.getTargetIcon(a.link),alt:"icon",width:"24",height:"24"},null,8,R)):v("",!0),"text"===a.iconType?(L(),g("div",z,P(a.name.slice(0,1)),1)):v("",!0),f("div",X,P(a.name),1)],40,F)])),_:1},8,["modelValue","onChoose","onUnchoose","onEnd"])]),Y,f("div",$,[h(i,{modelValue:e.cloneBackupEngineList,"onUpdate:modelValue":a[2]||(a[2]=a=>e.cloneBackupEngineList=a),"item-key":"name",group:"people",class:"backupEngineList engine-list",onEnd:e.handleDragEnd},{item:y((({element:a})=>[f("div",G,["local"===a.iconType||"network"===a.iconType?(L(),g("img",{key:0,src:a.iconPath,alt:"icon",width:"24",height:"24"},null,8,M)):v("",!0),"api"===a.iconType?(L(),g("img",{key:1,src:e.getTargetIcon(a.link),alt:"icon",width:"24",height:"24"},null,8,W)):v("",!0),"text"===a.iconType?(L(),g("div",H,P(a.name.slice(0,1)),1)):v("",!0),f("div",K,P(a.name),1)])])),_:1},8,["modelValue","onEnd"]),e.showDeleteArea?(L(),g("div",Q,"拖拽至此处删除")):v("",!0)])])]),h(u,{ref:"engineDialog",animationMode:"",title:(e.state.formData._id?"编辑":"添加")+"自定义引擎",width:"min(380px, 90vw)",height:"min(460px, 80vh)",customClass:"add-engine-dialog",closeOnClickOutside:!1,listenWindowSizeChange:"",appendToBody:""},{footer:y((()=>[f("div",re,[f("button",{type:"button",class:"btn",onClick:a[8]||(a[8]=(...a)=>e.close&&e.close(...a))},"取消"),f("button",{type:"button",class:"btn btn-primary",onClick:a[9]||(a[9]=(...a)=>e.submit&&e.submit(...a))},"确认")])])),default:y((()=>[h(p,{ref:"form","label-width":"80px",model:e.state.formData,rules:e.state.formRules},{default:y((()=>[h(r,{label:"引擎名称",prop:"name"},{default:y((()=>[h(s,{modelValue:e.state.formData.name,"onUpdate:modelValue":a[3]||(a[3]=a=>e.state.formData.name=a),placeholder:"请输入引擎名称"},null,8,["modelValue"])])),_:1}),h(r,{label:"引擎地址",prop:"link"},{default:y((()=>[f("div",Z,[h(s,{modelValue:e.state.formData.link,"onUpdate:modelValue":a[4]||(a[4]=a=>e.state.formData.link=a),placeholder:"请输入引擎地址",onBlur:e.handleLinkInputBlur},null,8,["modelValue","onBlur"]),h(c,{effect:"dark",placement:"bottom"},{content:y((()=>[ae,te])),default:y((()=>[ee])),_:1})])])),_:1}),h(r,{label:"引擎图标",prop:"iconType"},{default:y((()=>[h(m,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":a[5]||(a[5]=a=>e.state.formData.iconType=a)},{default:y((()=>[(L(!0),g(b,null,V(e.iconTypeList,(e=>(L(),I(d,{label:e.value,key:e.value},{default:y((()=>[C(P(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),"network"===e.state.formData.iconType?(L(),I(r,{key:0,label:"图标地址",prop:"iconPath"},{default:y((()=>[h(m,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":a[7]||(a[7]=a=>e.state.formData.iconType=a)},{default:y((()=>[h(s,{modelValue:e.state.formData.iconPath,"onUpdate:modelValue":a[6]||(a[6]=a=>e.state.formData.iconPath=a),placeholder:"请输入图标地址"},null,8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})):v("",!0),h(r,{label:"图标预览"},{default:y((()=>[f("div",ne,[e.showIconPreview?(L(),g(b,{key:0},["network"===e.state.formData.iconType?(L(),g("img",{key:0,src:e.state.formData.iconPath,alt:"icon",width:"24",height:"24"},null,8,le)):v("",!0),"api"===e.state.formData.iconType?(L(),g("img",{key:1,src:e.tempIconLink,alt:"icon",width:"24",height:"24"},null,8,oe)):v("",!0),"text"===e.state.formData.iconType?(L(),g("div",ie,P(e.state.formData.name.slice(0,1)),1)):v("",!0)],64)):(L(),g("div",se))])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title"])],64)}],["__scopeId","data-v-b7861120"]]);export{ce as default};
